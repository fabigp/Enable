<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="perfil.css">
    
    <title>Enable</title>
</head>
<body>
    <header class="header">
        <a href="index.html"><h1 class="header-h1">enable</h1></a>
        <input class="header-buscador" type="search">
        <div class="header-botones">
            <a class="header-h2" href="inicio.html">Log out</a>
        </div>
    </header>

    <main class="main">

        <section class="lapiz">
            <button popoverTarget="editor" class="boton"><i class="fa-solid fa-pen"></i></button>
        </section>

        <section class="menu">  
            <a href="index.html"><i class="fa-solid fa-house"></i></a>
            <a href="registro.html"><i class="fa-solid fa-gear"></i></a>
            <a class="yellow" href="perfil.html"><i class="fa-solid fa-paint-roller yellow"></i></a>
            <a class="blue" href="perfil2.html"><i class="fa-solid fa-paint-roller blue"></i></a>
        </section>

        <section class="perfil">
            <img class="perfil-img" src="fondo1.jpeg" alt="atardecer">
            <img class="menu-img" id="userAvatar" src="https://randomuser.me/api/portraits/women/63.jpg" alt="Perfil">

            <div class="perfil-salsa">
                <div class="perfil-buton">
                    <div class="perfil-star">
                        <i class="fa-solid fa-star star-color tam"></i>
                        <h2 class="perfil-h2">512.2k</h2>
                    </div>
                    <h2 class="perfil-h3">Nivel de prestigio</h2>
                </div>

                <div class="perfil-ame">
                    <h2 id="namePlaceholder">Fabi García</h2>
                    <p class="perfil-text" id="usernamePlaceholder">@fabiperfilCPU03</p>
                </div>

                <div class="perfil-buton">
                    <h2 class="perfil-h2">Conóceme</h2>
                </div>
            </div>

            <div class="section-vert">
                <section class="section-post pos">
                    <div class="post-imga">
                        <img class="perfil-img s" src="comida.avif" alt="Imagen1">
                        <p class="post-imgdesc">Comida Saludable</p>
                    </div>

                    <div class="section-comenti">
                        <p class="section-text">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Ipsum, officia? Debitis quas aperiam voluptatum, aliquam provident minima voluptas architecto quaerat hic commodi nam voluptate, corrupti vitae possimus est dolores, veniam nobis modi corporis? Assumenda hic similique ratione eligendi quae unde? Non nulla enim temporibus omnis dignissimos eligendi! Doloribus, ipsam facilis! Lorem ipsum dolor sit amet consectetur adipisicing elit. Praesentium quis corporis harum quae. Explicabo repellat fugit, quo amet distinctio aliquid, omnis cupiditate possimus sit perferendis maxime fuga? Quod, assumenda quos. Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga libero, temporibus laborum quae culpa maxime doloribus officiis odio repellat deserunt voluptate veritatis asperiores voluptas, iure optio commodi deleniti enim numquam.</p>
                    </div>

                    <div class="section-reacciones">
                        <input class="section-inpu" type="text">
                        <div>
                            <i class="fa-solid fa-bookmark"></i>
                            <i class="fa-solid fa-paper-plane"></i>
                        </div>
                    </div>
                </section>
            </div>
        </section>

        <section class="menu">  
            <i class="fa-solid fa-house sha"></i>
            <i class="fa-solid fa-gear sha"></i>
        </section>

        <section id="editor" class="editor" popover>
            <section>
                <div class="wp-webdeasy-comment-editor">
                    <div class="toolbar">
                      <div class="line">
                        <div class="box">
                          <span
                            class="editor-btn icon smaller"
                            data-action="bold"
                            data-tag-name="b"
                            title="Bold"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/bold.png"
                            />
                          </span>
                          <span
                            class="editor-btn icon smaller"
                            data-action="italic"
                            data-tag-name="i"
                            title="Italic"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/italic.png"
                            />
                          </span>
                          <span
                            class="editor-btn icon smaller"
                            data-action="underline"
                            data-tag-name="u"
                            title="Underline"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/underline.png"
                            />
                          </span>
                          <span
                            class="editor-btn icon smaller"
                            data-action="strikeThrough"
                            data-tag-name="strike"
                            title="Strike through"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/30/000000/strikethrough.png"
                            />
                          </span>
                        </div>
                        <div class="box">
                          <span class="editor-btn icon has-submenu">
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/align-left.png"
                            />
                            <div class="submenu">
                              <span
                                class="editor-btn icon"
                                data-action="justifyLeft"
                                data-style="textAlign:left"
                                title="Justify left"
                              >
                                <img
                                  src="https://img.icons8.com/fluency-systems-filled/48/000000/align-left.png"
                                />
                              </span>
                              <span
                                class="editor-btn icon"
                                data-action="justifyCenter"
                                data-style="textAlign:center"
                                title="Justify center"
                              >
                                <img
                                  src="https://img.icons8.com/fluency-systems-filled/48/000000/align-center.png"
                                />
                              </span>
                              <span
                                class="editor-btn icon"
                                data-action="justifyRight"
                                data-style="textAlign:right"
                                title="Justify right"
                              >
                                <img
                                  src="https://img.icons8.com/fluency-systems-filled/48/000000/align-right.png"
                                />
                              </span>
                              <span
                                class="editor-btn icon"
                                data-action="formatBlock"
                                data-style="textAlign:justify"
                                title="Justify block"
                              >
                                <img
                                  src="https://img.icons8.com/fluency-systems-filled/48/000000/align-justify.png"
                                />
                              </span>
                            </div>
                          </span>
                          <span
                            class="editor-btn icon"
                            data-action="insertOrderedList"
                            data-tag-name="ol"
                            title="Insert ordered list"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/numbered-list.png"
                            />
                          </span>
                          <span
                            class="editor-btn icon"
                            data-action="insertUnorderedList"
                            data-tag-name="ul"
                            title="Insert unordered list"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/bulleted-list.png"
                            />
                          </span>
                          <span
                            class="editor-btn icon"
                            data-action="outdent"
                            title="Outdent"
                            data-required-tag="li"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/outdent.png"
                            />
                          </span>
                          <span class="editor-btn icon" data-action="indent" title="Indent">
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/indent.png"
                            />
                          </span>
                        </div>
                        <div class="box">
                          <span
                            class="editor-btn icon"
                            data-action="insertHorizontalRule"
                            title="Insert horizontal rule"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/horizontal-line.png"
                            />
                          </span>
                        </div>
                      </div>
                      <div class="line">
                        <div class="box">
                          <
                          <span class="editor-btn icon smaller" data-action="undo" title="Undo">
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/undo--v1.png"
                            />
                          </span>
                          <span
                            class="editor-btn icon"
                            data-action="removeFormat"
                            title="Remove format"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/remove-format.png"
                            />
                          </span>
                        </div>
                        <div class="box">
                          <span
                            class="editor-btn icon smaller"
                            data-action="createLink"
                            title="Insert Link"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/add-link.png"
                            />
                          </span>
                          <span
                            class="editor-btn icon smaller"
                            data-action="unlink"
                            data-tag-name="a"
                            title="Unlink"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/delete-link.png"
                            />
                          </span>
                        </div>
                        <div class="box">
                          <span
                            class="editor-btn icon"
                            data-action="toggle-view"
                            title="Show HTML-Code"
                          >
                            <img
                              src="https://img.icons8.com/fluency-systems-filled/48/000000/source-code.png"
                            />
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="content-area">
                      <div class="visuell-view" contenteditable></div>
                      <textarea class="html-view"></textarea>
                    </div>
                  </div>
                  <div class="modal">
                    <div class="modal-bg"></div>
                    <div class="modal-wrapper">
                      <div class="close">✖</div>
                      <div class="modal-content" id="modalCreateLink">
                        <h3>Insert Link</h3>
                        <input
                          type="text"
                          id="linkValue"
                          placeholder="Link (example: https://webdeasy.de/)"
                        />
                        <div class="row">
                          <input type="checkbox" id="new-tab" />
                          <label for="new-tab">Open in new Tab?</label>
                        </div>
                        <button class="done">Done</button>
                      </div>
                    </div>
                  </div>
            </section>
        </section>
    </main>
    <script src="https://kit.fontawesome.com/9922e4891c.js" crossorigin="anonymous"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
          let authToken = localStorage.getItem('authToken');
    
          // Si no existe authToken en localStorage, intentar obtenerlo de la URL
          if (!authToken) {
              const urlParams = new URLSearchParams(window.location.search);
              authToken = urlParams.get('id'); // Suponiendo que el parámetro en la URL se llama 'id'
          }
    
          // Si después de intentar obtenerlo de la URL aún no hay authToken, redirigir a inicio de sesión
          if (!authToken) {
              window.location.href = 'iniciosesion.html';
              return; // Salir de la función si no hay token
          }
    
          try {
              // Hacer la solicitud GET a la API para obtener la información del usuario
              const response = await fetch(`http://127.0.0.1:8000/user/${authToken}`);
    
              if (!response.ok) {
                  throw new Error('Failed to fetch user data');
              }
    
              const userData = await response.json();
    
              // Actualizar los elementos HTML con la información del usuario
              const userAvatarElement = document.getElementById('userAvatar');
              const namePlaceholderElement = document.getElementById('namePlaceholder');
              const usernamePlaceholderElement = document.getElementById('usernamePlaceholder');
    
           
              namePlaceholderElement.textContent = userData.name; // Actualizar con el nombre completo del usuario
              usernamePlaceholderElement.textContent = `@${userData.username}`; // Actualizar con el nombre de usuario
    
          } catch (error) {
              console.error('Error fetching user data:', error);
              // Manejar el error adecuadamente, por ejemplo, mostrando un mensaje al usuario
          }
      });
    </script>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const createPostElement = (post) => {
      return `
        <section class="section-post">
          <div class="section-user">
            <div class="section-userdata">
              <img class="section-img" src="${post.author.avatarUrl}" alt="user">
              <p class="section-text">@${post.author.username}</p>
            </div>
            <div class="section-star">
              <i class="fa-solid fa-star star-color"></i>
              <p class="section-text">${post.title}</p>
            </div>
          </div>

          <div class="section-coment">
            ${post.body}
            <button popoverTarget="mas" class="section-vermas">Ver más...</button>
          </div>

          <div class="section-reacciones">
            <input class="section-inpu" type="text">
            <div>
              <i class="fa-solid fa-bookmark"></i>
              <i class="fa-solid fa-paper-plane"></i>
            </div>
          </div>
        </section>
      `;
    };

    const fetchPosts = async () => {
      try {
        let authToken = localStorage.getItem('authToken');

        // Si no hay authToken en localStorage, intentar obtenerlo de la URL
        if (!authToken) {
          const urlParams = new URLSearchParams(window.location.search);
          authToken = urlParams.get('id'); // Suponiendo que el parámetro en la URL se llama 'id'
        }

        // Si después de intentar obtenerlo de la URL aún no hay authToken, redirigir a inicio de sesión
        if (!authToken) {
          window.location.href = 'iniciosesion.html';
          return; // Salir de la función si no hay token
        }

        const response = await fetch(`http://127.0.0.1:8000/user/post/${authToken}`);
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const posts = await response.json();
        console.log(posts);

        const vertContainer = document.getElementById('vert');

        // Insertar los posts en el contenedor
        posts.forEach((post) => {
          vertContainer.insertAdjacentHTML('beforeend', createPostElement(post));
        });

      } catch (error) {
        console.error('Error fetching posts:', error);
        // Manejar el error adecuadamente, por ejemplo, mostrar un mensaje al usuario
      }
    };

    fetchPosts();
  });
</script>

    
</body>
</html>
